{
  "info": {
    "name": "Backend API - Users",
    "description": "Postman collection for Backend API - User management endpoints including listing, retrieving, updating, and deleting users.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Users",
      "item": [
        {
          "name": "List All Users (Paginated)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response time is less than 2s\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});",
                  "",
                  "pm.test(\"Response has pagination data\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('items');",
                  "    pm.expect(jsonData).to.have.property('total');",
                  "    pm.expect(jsonData).to.have.property('page');",
                  "    pm.expect(jsonData).to.have.property('size');",
                  "});",
                  "",
                  "pm.test(\"Items is an array\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.items).to.be.an('array');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/users/?page=1&size=50",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "users", ""],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number (default: 1)"
                },
                {
                  "key": "size",
                  "value": "50",
                  "description": "Page size (default: 50, max: 100)"
                }
              ]
            },
            "description": "List all users with pagination. Superuser only. Returns paginated list of users ordered by creation date (newest first)."
          },
          "response": []
        },
        {
          "name": "List Users - Filter by Active",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response time is less than 50ms (optimized with index)\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(50);",
                  "});",
                  "",
                  "pm.test(\"All users are active\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    jsonData.items.forEach(function(user) {",
                  "        pm.expect(user.is_active).to.be.true;",
                  "    });",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/users/?is_active=true&page=1&size=50",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "users", ""],
              "query": [
                {
                  "key": "is_active",
                  "value": "true",
                  "description": "Filter by active status"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "size",
                  "value": "50"
                }
              ]
            },
            "description": "List users filtered by active status. Uses database index for fast filtering."
          },
          "response": []
        },
        {
          "name": "List Users - Filter by Superuser",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response time is less than 50ms (optimized with index)\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(50);",
                  "});",
                  "",
                  "pm.test(\"All users are superusers\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    jsonData.items.forEach(function(user) {",
                  "        pm.expect(user.is_superuser).to.be.true;",
                  "    });",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/users/?is_superuser=true&page=1&size=50",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "users", ""],
              "query": [
                {
                  "key": "is_superuser",
                  "value": "true",
                  "description": "Filter by superuser status"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "size",
                  "value": "50"
                }
              ]
            },
            "description": "List users filtered by superuser status. Uses database index for fast filtering."
          },
          "response": []
        },
        {
          "name": "List Users - Search by Name",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response time is less than 100ms\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(100);",
                  "});",
                  "",
                  "pm.test(\"Search results match query\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var searchTerm = 'test';",
                  "    jsonData.items.forEach(function(user) {",
                  "        var matchFound = ",
                  "            (user.username && user.username.toLowerCase().includes(searchTerm)) ||",
                  "            (user.email && user.email.toLowerCase().includes(searchTerm)) ||",
                  "            (user.full_name && user.full_name.toLowerCase().includes(searchTerm));",
                  "        pm.expect(matchFound).to.be.true;",
                  "    });",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/users/?search=test&page=1&size=50",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "users", ""],
              "query": [
                {
                  "key": "search",
                  "value": "test",
                  "description": "Search in username, email, or full_name"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "size",
                  "value": "50"
                }
              ]
            },
            "description": "Search users by username, email, or full name. Case-insensitive search."
          },
          "response": []
        },
        {
          "name": "List Users - Sort by Email",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response time is less than 50ms\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(50);",
                  "});",
                  "",
                  "pm.test(\"Users are sorted by email ascending\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.items.length > 1) {",
                  "        for (var i = 0; i < jsonData.items.length - 1; i++) {",
                  "            pm.expect(jsonData.items[i].email <= jsonData.items[i + 1].email).to.be.true;",
                  "        }",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/users/?sort_by=email&sort_order=asc&page=1&size=50",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "users", ""],
              "query": [
                {
                  "key": "sort_by",
                  "value": "email",
                  "description": "Sort by: created_at, username, or email"
                },
                {
                  "key": "sort_order",
                  "value": "asc",
                  "description": "Sort order: asc or desc"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "size",
                  "value": "50"
                }
              ]
            },
            "description": "List users sorted by email in ascending order."
          },
          "response": []
        },
        {
          "name": "Bulk Create Users",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Response time is less than 500ms\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});",
                  "",
                  "pm.test(\"Response is an array\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "pm.test(\"All users created successfully\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.length).to.equal(3);",
                  "    jsonData.forEach(function(user) {",
                  "        pm.expect(user).to.have.property('id');",
                  "        pm.expect(user).to.have.property('email');",
                  "        pm.expect(user).to.have.property('username');",
                  "    });",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "[\n  {\n    \"email\": \"bulk1@example.com\",\n    \"username\": \"bulkuser1\",\n    \"password\": \"SecurePass123!\",\n    \"full_name\": \"Bulk User 1\"\n  },\n  {\n    \"email\": \"bulk2@example.com\",\n    \"username\": \"bulkuser2\",\n    \"password\": \"SecurePass123!\",\n    \"full_name\": \"Bulk User 2\"\n  },\n  {\n    \"email\": \"bulk3@example.com\",\n    \"username\": \"bulkuser3\",\n    \"password\": \"SecurePass123!\",\n    \"full_name\": \"Bulk User 3\"\n  }\n]"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/users/bulk",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "users", "bulk"]
            },
            "description": "Create multiple users in a single transaction. Superuser only. All users created atomically - if one fails, all fail."
          },
          "response": []
        },
        {
          "name": "Get User by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response time is less than 2s\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});",
                  "",
                  "pm.test(\"Response has user data\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('email');",
                  "    pm.expect(jsonData).to.have.property('username');",
                  "});",
                  "",
                  "pm.test(\"User ID matches requested ID\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var requestedId = pm.request.url.path[pm.request.url.path.length - 1];",
                  "    pm.expect(jsonData.id.toString()).to.equal(requestedId);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/users/1",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "users", "1"]
            },
            "description": "Get user by ID. Users can only view their own profile unless they're superuser. Cached for 5 minutes. Rate limited to 20 requests per minute."
          },
          "response": []
        },
        {
          "name": "Update User",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response time is less than 2s\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});",
                  "",
                  "pm.test(\"Response has updated user data\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('updated_at');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"full_name\": \"Updated Name\",\n  \"email\": \"newemail@example.com\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/v1/users/1",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "users", "1"]
            },
            "description": "Update user information. Users can only update their own profile unless they're superuser. Rate limited to 10 requests per minute. Invalidates cache."
          },
          "response": []
        },
        {
          "name": "Delete User",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Status code is 204\", function () {",
                  "    pm.response.to.have.status(204);",
                  "});",
                  "",
                  "pm.test(\"Response time is less than 2s\", function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{access_token}}",
                  "type": "string"
                }
              ]
            },
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/v1/users/2",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "users", "2"]
            },
            "description": "Delete user by ID. Superuser only. Cascades to delete all related sessions. Rate limited to 5 requests per minute."
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8000",
      "type": "string"
    }
  ]
}
