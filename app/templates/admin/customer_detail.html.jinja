{% extends "admin/base.html.jinja" %}

{% block title %}Customer Details - WindX Admin{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">{{ customer.company_name or customer.contact_person }}</h1>
        <p class="text-gray-500 mt-1">Customer ID: #{{ customer.id }}</p>
    </div>
    <div class="flex gap-2">
        <a href="/api/v1/admin/customers" class="btn btn-outline">
            <span>←</span> Back
        </a>
        <a href="/api/v1/admin/customers/{{ customer.id }}/edit" class="btn btn-primary">
            <span>✏️</span> Edit Customer
        </a>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Left Column: Customer Info -->
    <div class="lg:col-span-1 space-y-6">
        <!-- Contact Info -->
        <div class="card">
            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Contact Information</h3>
            <dl class="space-y-3">
                <div>
                    <dt class="text-sm font-medium text-gray-500">Contact Person</dt>
                    <dd class="text-base">{{ customer.contact_person }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Email</dt>
                    <dd class="text-base">
                        {% if customer.email %}
                        <a href="mailto:{{ customer.email }}" class="text-blue-600 hover:underline">{{ customer.email }}</a>
                        {% else %}
                        <span class="text-gray-400">N/A</span>
                        {% endif %}
                    </dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Phone</dt>
                    <dd class="text-base">{{ customer.phone or '<span class="text-gray-400">N/A</span>'|safe }}</dd>
                </div>
            </dl>
        </div>

        <!-- Classification -->
        <div class="card">
            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Classification</h3>
            <dl class="space-y-3">
                <div>
                    <dt class="text-sm font-medium text-gray-500">Type</dt>
                    <dd class="text-base capitalize">{{ customer.customer_type }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Status</dt>
                    <dd>
                        {% if customer.is_active %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Active
                        </span>
                        {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                            Inactive
                        </span>
                        {% endif %}
                    </dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Tax ID</dt>
                    <dd class="text-base">{{ customer.tax_id or '<span class="text-gray-400">N/A</span>'|safe }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-medium text-gray-500">Payment Terms</dt>
                    <dd class="text-base capitalize">{{ customer.payment_terms|replace('_', ' ') }}</dd>
                </div>
            </dl>
        </div>

        <!-- Address -->
        <div class="card">
            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Address</h3>
            {% if customer.address %}
            <address class="not-italic text-gray-600">
                {{ customer.address.street }}<br>
                {{ customer.address.city }}, {{ customer.address.state }} {{ customer.address.zip }}<br>
                {{ customer.address.country }}
            </address>
            {% else %}
            <p class="text-gray-400">No address on file</p>
            {% endif %}
        </div>
        
        <!-- Notes -->
        {% if customer.notes %}
        <div class="card">
            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Notes</h3>
            <p class="text-gray-600 whitespace-pre-wrap">{{ customer.notes }}</p>
        </div>
        {% endif %}
    </div>

    <!-- Right Column: Related Data -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Configurations -->
        <div class="card">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-lg font-semibold">Configurations</h3>
                <span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                    {{ customer.configurations|length }}
                </span>
            </div>
            
            {% if customer.configurations %}
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th class="px-4 py-2">Name</th>
                            <th class="px-4 py-2">Type</th>
                            <th class="px-4 py-2">Price</th>
                            <th class="px-4 py-2">Created</th>
                            <th class="px-4 py-2">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for config in customer.configurations %}
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-4 py-2 font-medium">{{ config.name }}</td>
                            <td class="px-4 py-2">{{ config.manufacturing_type.name if config.manufacturing_type else 'Unknown' }}</td>
                            <td class="px-4 py-2">${{ "%.2f"|format(config.total_price or 0) }}</td>
                            <td class="px-4 py-2">{{ config.created_at.strftime('%Y-%m-%d') }}</td>
                            <td class="px-4 py-2">
                                <a href="#" class="text-blue-600 hover:underline">View</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-gray-500 text-center py-4">No configurations found.</p>
            {% endif %}
        </div>

        <!-- Quotes -->
        <div class="card">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h3 class="text-lg font-semibold">Quotes</h3>
                <span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                    {{ customer.quotes|length }}
                </span>
            </div>
            
            {% if customer.quotes %}
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th class="px-4 py-2">Quote #</th>
                            <th class="px-4 py-2">Total</th>
                            <th class="px-4 py-2">Status</th>
                            <th class="px-4 py-2">Valid Until</th>
                            <th class="px-4 py-2">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for quote in customer.quotes %}
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-4 py-2 font-medium">{{ quote.quote_number }}</td>
                            <td class="px-4 py-2">${{ "%.2f"|format(quote.total_amount or 0) }}</td>
                            <td class="px-4 py-2">
                                <span class="px-2 py-1 rounded-full text-xs font-medium 
                                    {% if quote.status == 'accepted' %}bg-green-100 text-green-800
                                    {% elif quote.status == 'sent' %}bg-blue-100 text-blue-800
                                    {% elif quote.status == 'expired' %}bg-gray-100 text-gray-800
                                    {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                    {{ quote.status|upper }}
                                </span>
                            </td>
                            <td class="px-4 py-2">{{ quote.valid_until.strftime('%Y-%m-%d') }}</td>
                            <td class="px-4 py-2">
                                <a href="#" class="text-blue-600 hover:underline">View</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-gray-500 text-center py-4">No quotes found.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
