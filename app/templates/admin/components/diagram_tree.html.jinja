<style>
    .diagram-tree-container {
        background-color: #ffffff;
        padding: 1.5rem;
        border-radius: 0.375rem;
        overflow: auto;
        min-height: 400px;
        display: flex;
        flex-direction: column;
    }
    
    .diagram-tree-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #dee2e6;
    }
    
    .diagram-tree-title {
        color: #495057;
        font-weight: 600;
        margin: 0;
    }
    
    .diagram-tree-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .diagram-btn {
        background-color: #f8f9fa;
        color: #495057;
        border: 1px solid #dee2e6;
        padding: 0.25rem 0.75rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .diagram-btn:hover {
        background-color: #e9ecef;
        border-color: #adb5bd;
    }
    
    .diagram-content {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f8f9fa;
        border-radius: 0.25rem;
        padding: 1rem;
    }
    
    .diagram-image {
        max-width: 100%;
        height: auto;
        border-radius: 0.25rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .diagram-placeholder {
        text-align: center;
        color: #6c757d;
        padding: 3rem 1rem;
    }
    
    .diagram-placeholder i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }
</style>

<div class="diagram-tree-container">
    <div class="diagram-tree-header">
        <h6 class="diagram-tree-title">
            <i class="bi bi-diagram-3"></i> Tree Diagram Visualization
        </h6>
        <div class="diagram-tree-actions">
            {% if diagram_tree %}
            <button class="diagram-btn" onclick="downloadDiagram()" id="downloadBtn">
                <i class="bi bi-download"></i> Download
            </button>
            <button class="diagram-btn" onclick="refreshDiagram()" id="refreshBtn">
                <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
            {% endif %}
        </div>
    </div>
    
    <div class="diagram-content">
        {% if diagram_tree %}
            <!-- Display the diagram image -->
            <img src="data:image/png;base64,{{ diagram_tree }}" 
                 alt="Tree Diagram" 
                 class="diagram-image"
                 id="diagramImage">
        {% else %}
            <div class="diagram-placeholder">
                <i class="bi bi-diagram-3"></i>
                <p class="mb-0">Diagram visualization will appear here</p>
                <small class="text-muted">
                    The system will generate a visual diagram of the hierarchy tree
                </small>
            </div>
        {% endif %}
    </div>
</div>

<script>
    function downloadDiagram() {
        const img = document.getElementById('diagramImage');
        if (!img) return;
        
        // Create a temporary link element
        const link = document.createElement('a');
        link.href = img.src;
        link.download = 'hierarchy-diagram-' + new Date().getTime() + '.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Show feedback
        const btn = document.getElementById('downloadBtn');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="bi bi-check"></i> Downloaded!';
        btn.style.backgroundColor = '#d1e7dd';
        btn.style.borderColor = '#badbcc';
        
        setTimeout(function() {
            btn.innerHTML = originalHTML;
            btn.style.backgroundColor = '';
            btn.style.borderColor = '';
        }, 2000);
    }
    
    function refreshDiagram() {
        const btn = document.getElementById('refreshBtn');
        const originalHTML = btn.innerHTML;
        
        // Show loading state
        btn.innerHTML = '<i class="bi bi-arrow-clockwise"></i> Refreshing...';
        btn.disabled = true;
        
        // Reload the page to regenerate the diagram
        setTimeout(function() {
            window.location.reload();
        }, 500);
    }
    
    // Add zoom functionality to diagram
    document.addEventListener('DOMContentLoaded', function() {
        const img = document.getElementById('diagramImage');
        if (!img) return;
        
        let scale = 1;
        const scaleStep = 0.1;
        const maxScale = 3;
        const minScale = 0.5;
        
        img.style.cursor = 'zoom-in';
        img.style.transition = 'transform 0.2s ease';
        
        img.addEventListener('click', function() {
            scale += scaleStep;
            if (scale > maxScale) {
                scale = minScale;
            }
            img.style.transform = `scale(${scale})`;
            img.style.cursor = scale >= maxScale ? 'zoom-out' : 'zoom-in';
        });
    });
</script>
