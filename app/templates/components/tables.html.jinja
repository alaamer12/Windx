{# Enhanced Table Components - RBAC-aware table elements with modern styling #}

{% from "components/rbac_helpers.html.jinja" import rbac_button with context %}

{# 
  RBAC Table Actions Macro
  Renders table row action buttons with automatic RBAC filtering
  Now with enhanced modern styling and hover effects
#}
{% macro rbac_table_actions(item, actions) %}
  <div class="flex justify-end gap-1.5">
    {% for action in actions %}
      {% if not action.get('permission') or can(action.permission) %}
        {% if not action.get('role') or has.role(action.role) %}
          {% set action_url = action.url.format(id=item.id) if action.url is string else action.url(item) %}
          <a href="{{ action_url }}"
             class="inline-flex items-center justify-center w-8 h-8 rounded-lg transition-all duration-200 hover:scale-105 {{ action.get('class', 'bg-gray-50 hover:bg-gray-100 text-gray-600 hover:text-gray-900 border border-gray-200') }}"
             title="{{ action.title }}"
             {% if action.get('onclick') %}onclick="{{ action.onclick }}"{% endif %}>
            <span class="text-sm">{{ action.icon }}</span>
          </a>
        {% endif %}
      {% endif %}
    {% endfor %}
  </div>
{% endmacro %}

{# 
  RBAC Table Header Macro
  Renders a modern, professional table header with optional sortable columns
#}
{% macro rbac_table_header(columns) %}
  <thead class="bg-gradient-to-r from-gray-50 to-gray-100/50 border-b border-gray-200">
    <tr>
      {% for column in columns %}
        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider
                   {% if column.get('align') == 'center' %}text-center{% elif column.get('align') == 'right' %}text-right{% endif %}
                   {% if column.get('sortable') %}cursor-pointer hover:bg-gray-100 transition-colors duration-150{% endif %}"
            {% if column.get('width') %}style="width: {{ column.width }};"{% endif %}
            {% if column.get('sortable') %}onclick="sortTable('{{ column.key }}')"{% endif %}>
          <div class="flex items-center gap-2 {% if column.get('align') == 'center' %}justify-center{% elif column.get('align') == 'right' %}justify-end{% endif %}">
            <span>{{ column.label }}</span>
            {% if column.get('sortable') %}
              <svg class="w-4 h-4 text-gray-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
              </svg>
            {% endif %}
          </div>
        </th>
      {% endfor %}
    </tr>
  </thead>
{% endmacro %}

{# 
  Table Row Wrapper Macro
  Provides consistent styling for table rows with hover effects
#}
{% macro table_row(content, clickable=False, href=None) %}
  <tr class="border-b border-gray-100 transition-all duration-150 hover:bg-gray-50/50 
             {% if clickable %}cursor-pointer hover:shadow-sm{% endif %}"
      {% if clickable and href %}onclick="window.location='{{ href }}'"{% endif %}>
    {{ content }}
  </tr>
{% endmacro %}

{# 
  Table Cell Macro
  Renders a table cell with consistent padding and styling
#}
{% macro table_cell(content, align='left', class='') %}
  <td class="px-6 py-4 text-sm text-gray-900 
             {% if align == 'center' %}text-center{% elif align == 'right' %}text-right{% endif %} 
             {{ class }}">
    {{ content }}
  </td>
{% endmacro %}

{# 
  Empty State Macro
  Modern empty state with improved visual hierarchy
#}
{% macro empty_state(icon, title, message, action_text=None, action_href=None, action_permission=None) %}
  <div class="flex flex-col items-center justify-center py-16 px-4">
    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center mb-6 shadow-inner">
      <span class="text-4xl opacity-60">{{ icon }}</span>
    </div>
    <h3 class="text-xl font-semibold text-gray-900 mb-2">{{ title }}</h3>
    <p class="text-gray-500 text-center max-w-md mb-6">{{ message }}</p>
    {% if action_text and action_href %}
      {{ rbac_button(
        action_text,
        action_href,
        permission=action_permission,
        class="inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-medium rounded-lg shadow-sm hover:shadow-md transition-all duration-200 transform hover:-translate-y-0.5",
        onclick=None
      ) }}
    {% endif %}
  </div>
{% endmacro %}

{# 
  Status Badge Macro
  Modern status badges with refined styling
#}
{% macro status_badge(status, label=None, type=None) %}
  {% set badge_label = label or status|title %}
  {% set badge_type = type or ("success" if status == "active" else "info") %}
  
  {% if badge_type == "success" %}
    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200 shadow-sm">
      <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 mr-2"></span>
      {{ badge_label }}
    </span>
  {% elif badge_type == "warning" %}
    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-amber-50 text-amber-700 border border-amber-200 shadow-sm">
      <span class="w-1.5 h-1.5 rounded-full bg-amber-500 mr-2"></span>
      {{ badge_label }}
    </span>
  {% elif badge_type == "error" %}
    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-rose-50 text-rose-700 border border-rose-200 shadow-sm">
      <span class="w-1.5 h-1.5 rounded-full bg-rose-500 mr-2"></span>
      {{ badge_label }}
    </span>
  {% else %}
    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-50 text-slate-700 border border-slate-200 shadow-sm">
      <span class="w-1.5 h-1.5 rounded-full bg-slate-400 mr-2"></span>
      {{ badge_label }}
    </span>
  {% endif %}
{% endmacro %}

{#
  Table Container Macro
  Wraps table with modern card-like container
#}
{% macro table_container(content=None, title=None, description=None, actions=None) %}
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
    {% if title or description or actions %}
      <div class="px-6 py-5 border-b border-gray-200 bg-gradient-to-r from-white to-gray-50">
        <div class="flex items-center justify-between">
          <div>
            {% if title %}
              <h2 class="text-lg font-semibold text-gray-900">{{ title }}</h2>
            {% endif %}
            {% if description %}
              <p class="mt-1 text-sm text-gray-500">{{ description }}</p>
            {% endif %}
          </div>
          {% if actions %}
            <div class="flex gap-2">
              {{ actions }}
            </div>
          {% endif %}
        </div>
      </div>
    {% endif %}
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        {% if caller %}
          {{ caller() }}
        {% else %}
          {{ content }}
        {% endif %}
      </table>
    </div>
  </div>
{% endmacro %}

{#
  Pagination Macro
  Modern pagination component
#}
{% macro pagination(current_page, total_pages, base_url) %}
  {% if total_pages > 1 %}
    <div class="flex items-center justify-between px-6 py-4 border-t border-gray-200 bg-gray-50/50">
      <div class="flex items-center gap-2">
        <span class="text-sm text-gray-600">
          Page {{ current_page }} of {{ total_pages }}
        </span>
      </div>
      <div class="flex items-center gap-1">
        {% if current_page > 1 %}
          <a href="{{ base_url }}?page={{ current_page - 1 }}" 
             class="inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-150">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            Previous
          </a>
        {% endif %}
        
        {% for page in range(1, total_pages + 1) %}
          {% if page == current_page %}
            <span class="inline-flex items-center px-4 py-2 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg shadow-sm">
              {{ page }}
            </span>
          {% elif page == 1 or page == total_pages or (page >= current_page - 1 and page <= current_page + 1) %}
            <a href="{{ base_url }}?page={{ page }}" 
               class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-150">
              {{ page }}
            </a>
          {% elif page == current_page - 2 or page == current_page + 2 %}
            <span class="inline-flex items-center px-2 text-gray-500">...</span>
          {% endif %}
        {% endfor %}
        
        {% if current_page < total_pages %}
          <a href="{{ base_url }}?page={{ current_page + 1 }}" 
             class="inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-150">
            Next
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
        {% endif %}
      </div>
    </div>
  {% endif %}
{% endmacro %}

{#
  Loading State Macro
  Shows skeleton loading state for tables
#}
{% macro loading_state(rows=5, columns=4) %}
  <div class="animate-pulse">
    {% for i in range(rows) %}
      <div class="border-b border-gray-100 px-6 py-4">
        <div class="flex gap-4">
          {% for j in range(columns) %}
            <div class="flex-1 h-4 bg-gray-200 rounded"></div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
{% endmacro %}

{#
  Search Bar Macro
  Modern search input for filtering tables
#}
{% macro search_bar(placeholder="Search...", name="search") %}
  <div class="relative">
    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
      <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
      </svg>
    </div>
    <input type="text" 
           name="{{ name }}" 
           placeholder="{{ placeholder }}"
           class="block w-full pl-10 pr-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm transition-all duration-150"
           autocomplete="off">
  </div>
{% endmacro %}