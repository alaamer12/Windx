{% extends "admin/base.html.jinja" %}
{% from "components/buttons.html.jinja" import button, button_group with context %}

{% block title %}{{ action|title }} Customer - WindX Admin{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">{{ action|title }} Customer</h1>
        <p class="text-gray-500 mt-1">
            {% if action == 'create' %}
            Add a new customer to the system
            {% else %}
            Update existing customer information
            {% endif %}
        </p>
    </div>
    {{ button(
        text="‚Üê Back to List",
        href="/api/v1/admin/customers",
        variant="outline"
    ) }}
</div>

<div class="card max-w-4xl">
    <form method="post" class="space-y-6">
        <!-- Basic Information -->
        <div>
            <h3 class="text-lg font-semibold mb-4 border-b pb-2">üë§ Basic Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                    <label class="form-label" for="company_name">Company Name</label>
                    <input type="text" id="company_name" name="company_name" class="form-control" 
                           value="{{ form_data.company_name if form_data else (customer.company_name if customer else '') }}" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="contact_person">Contact Person</label>
                    <input type="text" id="contact_person" name="contact_person" class="form-control" 
                           value="{{ form_data.contact_person if form_data else (customer.contact_person if customer else '') }}" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="email">Email Address</label>
                    <input type="email" id="email" name="email" class="form-control" 
                           value="{{ form_data.email if form_data else (customer.email if customer else '') }}">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" class="form-control" 
                           value="{{ form_data.phone if form_data else (customer.phone if customer else '') }}">
                </div>
            </div>
        </div>

        <!-- Classification -->
        <div>
            <h3 class="text-lg font-semibold mb-4 border-b pb-2">üè∑Ô∏è Classification & Terms</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="form-group">
                    <label class="form-label" for="customer_type">Customer Type</label>
                    <select id="customer_type" name="customer_type" class="form-control">
                        {% set current_type = form_data.customer_type if form_data else (customer.customer_type if customer else '') %}
                        <option value="residential" {% if current_type == 'residential' %}selected{% endif %}>Residential</option>
                        <option value="commercial" {% if current_type == 'commercial' %}selected{% endif %}>Commercial</option>
                        <option value="contractor" {% if current_type == 'contractor' %}selected{% endif %}>Contractor</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="tax_id">Tax ID</label>
                    <input type="text" id="tax_id" name="tax_id" class="form-control" 
                           value="{{ form_data.tax_id if form_data else (customer.tax_id if customer else '') }}">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="payment_terms">Payment Terms</label>
                    <select id="payment_terms" name="payment_terms" class="form-control">
                        {% set current_terms = form_data.payment_terms if form_data else (customer.payment_terms if customer else '') %}
                        <option value="due_on_receipt" {% if current_terms == 'due_on_receipt' %}selected{% endif %}>Due on Receipt</option>
                        <option value="net_15" {% if current_terms == 'net_15' %}selected{% endif %}>Net 15</option>
                        <option value="net_30" {% if current_terms == 'net_30' %}selected{% endif %}>Net 30</option>
                        <option value="net_60" {% if current_terms == 'net_60' %}selected{% endif %}>Net 60</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Address -->
        <div>
            <h3 class="text-lg font-semibold mb-4 border-b pb-2">üìç Address</h3>
            <div class="form-group">
                <label class="form-label" for="street">Street Address</label>
                <input type="text" id="street" name="street" class="form-control" 
                       value="{{ form_data.address.street if form_data and form_data.address else (customer.address.street if customer and customer.address else '') }}">
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                    <label class="form-label" for="city">City</label>
                    <input type="text" id="city" name="city" class="form-control" 
                           value="{{ form_data.address.city if form_data and form_data.address else (customer.address.city if customer and customer.address else '') }}">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="state">State/Province</label>
                    <input type="text" id="state" name="state" class="form-control" 
                           value="{{ form_data.address.state if form_data and form_data.address else (customer.address.state if customer and customer.address else '') }}">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="zip_code">Zip/Postal Code</label>
                    <input type="text" id="zip_code" name="zip_code" class="form-control" 
                           value="{{ form_data.address.zip if form_data and form_data.address else (customer.address.zip if customer and customer.address else '') }}">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="country">Country</label>
                    <input type="text" id="country" name="country" class="form-control" 
                           value="{{ form_data.address.country if form_data and form_data.address else (customer.address.country if customer and customer.address else 'USA') }}">
                </div>
            </div>
        </div>

        <!-- Notes & Settings -->
        <div>
            <h3 class="text-lg font-semibold mb-4 border-b pb-2">üìù Notes & Settings</h3>
            <div class="form-group">
                <label class="form-label" for="notes">Internal Notes</label>
                <textarea id="notes" name="notes" class="form-control" rows="4">{{ form_data.notes if form_data else (customer.notes if customer else '') }}</textarea>
            </div>
            
            <div class="form-group flex items-center gap-2">
                <input type="checkbox" id="is_active" name="is_active" value="true" 
                       {% if (form_data and form_data.is_active) or (customer and customer.is_active) or (not form_data and not customer) %}checked{% endif %}>
                <label for="is_active" class="font-medium">Active Customer</label>
            </div>
        </div>

        <!-- Actions -->
        {% call button_group(align="right", gap="md", class="pt-4 border-t") %}
            {{ button(
                text="Cancel",
                href="/api/v1/admin/customers",
                variant="outline"
            ) }}
            {{ button(
                text="üíæ " + ('Create Customer' if action == 'create' else 'Update Customer'),
                type="submit",
                variant="primary"
            ) }}
        {% endcall %}
    </form>
</div>
{% endblock %}
