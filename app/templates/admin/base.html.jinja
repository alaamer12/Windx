<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}WindX Admin{% endblock %}</title>
    
    <!-- Infima CSS Framework -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/infima@0.2.0-alpha.44/dist/css/default/default.css">
    
    <!-- Custom Admin Styles -->
    <link rel="stylesheet" href="/static/css/admin.css">
    
    <style>
        /* Page-specific overrides can go here */
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">
    {% if not hide_sidebar %}
        {% include "admin/components/navbar.html.jinja" %}
        {% include "admin/components/sidebar.html.jinja" %}
    {% endif %}

    <main class="main-content" {% if hide_sidebar %}style="margin-left: 0; padding: 0;"{% endif %}>
        {% include "admin/components/alerts.html.jinja" %}
        
        {% block content %}{% endblock %}
    </main>

    {% block scripts %}{% endblock %}
    <script>
        // Check for error/success in URL parameters and show toast
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            let error = urlParams.get('error');
            let success = urlParams.get('success');
            
            // Also check for server-side injected variables
            {% if error %}
            if (!error) error = "{{ error }}";
            {% endif %}
            {% if success %}
            if (!success) success = "{{ success }}";
            {% endif %}
            
            if (error) {
                showToast(error, 'error');
                // Clean URL if it was from params
                if (urlParams.get('error')) {
                    urlParams.delete('error');
                    const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
                    window.history.replaceState({}, document.title, newUrl);
                }
            }
            
            if (success) {
                showToast(success, 'success');
                // Clean URL if it was from params
                if (urlParams.get('success')) {
                    urlParams.delete('success');
                    const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
                    window.history.replaceState({}, document.title, newUrl);
                }
            }
        });

        function showToast(message, type = 'info') {
            // Create toast container if it doesn't exist
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px;';
                document.body.appendChild(container);
            }
            
            // Create toast element
            const toast = document.createElement('div');
            toast.style.cssText = `
                background-color: ${type === 'error' ? '#fee2e2' : type === 'success' ? '#dcfce7' : '#eff6ff'};
                color: ${type === 'error' ? '#991b1b' : type === 'success' ? '#166534' : '#1e40af'};
                padding: 1rem 1.5rem;
                border-radius: 0.5rem;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                display: flex;
                align-items: center;
                gap: 0.75rem;
                min-width: 300px;
                transform: translateX(100%);
                transition: transform 0.3s ease-in-out;
                border: 1px solid ${type === 'error' ? '#fecaca' : type === 'success' ? '#bbf7d0' : '#dbeafe'};
            `;
            
            // Icon
            const icon = document.createElement('span');
            icon.textContent = type === 'error' ? '⚠️' : type === 'success' ? '✅' : 'ℹ️';
            
            // Text
            const text = document.createElement('span');
            text.textContent = message;
            text.style.fontWeight = '500';
            
            toast.appendChild(icon);
            toast.appendChild(text);
            container.appendChild(toast);
            
            // Animate in
            requestAnimationFrame(() => {
                toast.style.transform = 'translateX(0)';
            });
            
            // Remove after 5 seconds
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 5000);
        }
    </script>
</body>
</html>
