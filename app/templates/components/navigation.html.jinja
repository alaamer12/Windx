{# Navigation Components - RBAC-aware navigation elements #}

{% import "components/rbac_helpers.html.jinja" as rbac with context %}

{# 
  RBAC Sidebar Macro
  Renders the admin sidebar with automatic RBAC filtering of menu items
  
  Parameters:
    - active_page: String indicating which page is currently active
  
  Usage:
    {{ rbac_sidebar(active_page="dashboard") }}
#}
{% macro rbac_sidebar(active_page=None) %}
  <aside class="sidebar" x-data="{ collapsed: false }" :class="{ 'collapsed': collapsed }">
    <div class="sidebar-header">
      <a href="/api/v1/admin/dashboard" class="logo" x-show="!collapsed" x-transition>WindX Admin</a>
      <!-- Toggle Button -->
      <button 
        @click="collapsed = !collapsed" 
        class="sidebar-toggle-btn"
        :class="{ 'collapsed': collapsed }"
        title="Toggle Sidebar"
        type="button">
        <svg x-show="!collapsed" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
        <svg x-show="collapsed" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <nav class="sidebar-nav">
      {{ rbac.rbac_nav_item(
        'Dashboard',
        '/api/v1/admin/dashboard',
        active=(active_page == 'dashboard'),
        icon='ğŸ“Š'
      ) }}
      
      {{ rbac.rbac_nav_item(
        'Manufacturing Types',
        '/api/v1/admin/manufacturing-types',
        permission='manufacturing_type:read',
        active=(active_page == 'manufacturing'),
        icon='ğŸ­'
      ) }}
      
      {{ rbac.rbac_nav_item(
        'Hierarchy Editor',
        '/api/v1/admin/hierarchy',
        permission='attribute_node:read',
        active=(active_page == 'hierarchy'),
        icon='ğŸŒ³'
      ) }}
      
      {# Entry Pages - submenu #}
      <div class="nav-section">
        <div class="nav-section-title" x-show="!collapsed" x-transition>Entry</div>
        {{ rbac.rbac_nav_item(
          'Profile',
          '/api/v1/admin/entry/profile',
          permission='configuration:create',
          active=(active_page == 'entry_profile'),
          icon='ğŸ“'
        ) }}
        {{ rbac.rbac_nav_item(
          'Accessories',
          '/api/v1/admin/entry/accessories',
          permission='configuration:create',
          active=(active_page == 'entry_accessories'),
          icon='ğŸ”§'
        ) }}
        {{ rbac.rbac_nav_item(
          'Glazing',
          '/api/v1/admin/entry/glazing',
          permission='configuration:create',
          active=(active_page == 'entry_glazing'),
          icon='ğŸªŸ'
        ) }}
      </div>
      
      {# Customers - conditionally enabled #}
      {% if enable_customers %}
        {{ rbac.rbac_nav_item(
          'Customers',
          '/api/v1/admin/customers',
          permission='customer:read',
          active=(active_page == 'customers'),
          icon='ğŸ‘¥',
          badge='Beta'
        ) }}
      {% else %}
        {{ rbac.rbac_nav_item(
          'Customers',
          '#',
          permission='customer:read',
          icon='ğŸ‘¥',
          badge='Soon',
          disabled=True
        ) }}
      {% endif %}
      
      {# Orders - conditionally enabled #}
      {% if enable_orders %}
        {{ rbac.rbac_nav_item(
          'Orders',
          '/api/v1/admin/orders',
          permission='order:read',
          active=(active_page == 'orders'),
          icon='ğŸ“¦',
          badge='Beta'
        ) }}
      {% else %}
        {{ rbac.rbac_nav_item(
          'Orders',
          '#',
          permission='order:read',
          icon='ğŸ“¦',
          badge='Soon',
          disabled=True
        ) }}
      {% endif %}
      
      {{ rbac.rbac_nav_item(
        'Settings',
        '/api/v1/admin/settings',
        role='SUPERADMIN',
        active=(active_page == 'settings'),
        icon='âš™ï¸'
      ) }}
      
      {{ rbac.rbac_nav_item(
        'Documentation',
        '/api/v1/admin/documentation',
        active=(active_page == 'documentation'),
        icon='ğŸ“š'
      ) }}
    </nav>
    
    <div class="sidebar-footer">
      <div class="user-info" x-show="!collapsed" x-transition>
        <span class="user-icon">ğŸ‘¤</span>
        <span class="user-name">{{ current_user.username if current_user else 'Admin' }}</span>
      </div>
      <a href="/api/v1/admin/logout" class="logout-btn" :class="{ 'icon-only': collapsed }">
        <span x-show="!collapsed" x-transition>Logout</span>
        <span x-show="collapsed" x-transition>ğŸšª</span>
      </a>
    </div>
  </aside>
{% endmacro %}

{# 
  RBAC Navbar Macro
  Renders the top navigation bar with user context
  
  Parameters:
    None - uses current_user from context
  
  Usage:
    {{ rbac_navbar() }}
#}
{% macro rbac_navbar() %}
  <nav class="navbar">
    <div class="navbar-brand">
      <a href="/api/v1/admin/dashboard" class="logo">WindX Admin</a>
    </div>
    <div class="navbar-user">
      <span class="user-icon">ğŸ‘¤</span>
      <span class="user-name">{{ current_user.username if current_user else 'Admin' }}</span>
    </div>
  </nav>
{% endmacro %}
