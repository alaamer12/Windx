{% extends "admin/base.html.jinja" %}

{% block title %}Settings - WindX Admin{% endblock %}

{% block extra_css %}
<style>
    .settings-container {
        max-width: 800px;
    }

    .settings-section {
        margin-bottom: 2rem;
    }

    .settings-section-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text);
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--border);
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .form-help {
        font-size: 0.875rem;
        color: var(--text-light);
        margin-top: 0.25rem;
    }

    .password-requirements {
        background-color: #f8fafc;
        border: 1px solid var(--border);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-top: 0.5rem;
    }

    .password-requirements ul {
        margin: 0.5rem 0 0 1.5rem;
        padding: 0;
    }

    .password-requirements li {
        font-size: 0.875rem;
        color: var(--text-light);
        margin-bottom: 0.25rem;
    }

    .btn-group {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
    }

    .divider {
        height: 1px;
        background-color: var(--border);
        margin: 2rem 0;
    }

    .info-box {
        background-color: #eff6ff;
        border: 1px solid #bfdbfe;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1.5rem;
        display: flex;
        gap: 0.75rem;
    }

    .info-box-icon {
        font-size: 1.25rem;
    }

    .info-box-content {
        flex: 1;
    }

    .info-box-title {
        font-weight: 600;
        color: #1e40af;
        margin-bottom: 0.25rem;
    }

    .info-box-text {
        font-size: 0.875rem;
        color: #1e40af;
    }
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="page-header">
        <h1 class="page-title">Settings</h1>
    </div>

    <div class="info-box">
        <div class="info-box-icon">ℹ️</div>
        <div class="info-box-content">
            <div class="info-box-title">Account Settings</div>
            <div class="info-box-text">Update your account information. Changes will take effect immediately.</div>
        </div>
    </div>

    <div class="card">
        <!-- Username Section -->
        <div class="settings-section">
            <h2 class="settings-section-title">Change Username</h2>
            <form method="POST" action="/api/v1/admin/settings/update-username">
                <div class="form-group">
                    <label class="form-label" for="current_username">Current Username</label>
                    <input 
                        type="text" 
                        id="current_username" 
                        class="form-control" 
                        value="{{ current_user.username }}" 
                        disabled
                    >
                </div>

                <div class="form-group">
                    <label class="form-label" for="new_username">New Username</label>
                    <input 
                        type="text" 
                        id="new_username" 
                        name="new_username" 
                        class="form-control" 
                        placeholder="Enter new username"
                        pattern="^[a-zA-Z0-9_-]+$"
                        minlength="3"
                        maxlength="50"
                        required
                    >
                    <div class="form-help">Username must be 3-50 characters (letters, numbers, dash, underscore only)</div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Update Username</button>
                </div>
            </form>
        </div>

        <div class="divider"></div>

        <!-- Password Section -->
        <div class="settings-section">
            <h2 class="settings-section-title">Change Password</h2>
            <form method="POST" action="/api/v1/admin/settings/update-password">
                <div class="form-group">
                    <label class="form-label" for="new_password">New Password</label>
                    <input 
                        type="password" 
                        id="new_password" 
                        name="new_password" 
                        class="form-control" 
                        placeholder="Enter new password"
                        minlength="8"
                        maxlength="100"
                        required
                    >
                </div>

                <div class="form-group">
                    <label class="form-label" for="confirm_password">Confirm New Password</label>
                    <input 
                        type="password" 
                        id="confirm_password" 
                        name="confirm_password" 
                        class="form-control" 
                        placeholder="Confirm new password"
                        minlength="8"
                        maxlength="100"
                        required
                    >
                </div>

                <div class="password-requirements">
                    <strong>Password Requirements:</strong>
                    <ul>
                        <li>Minimum 8 characters</li>
                        <li>Maximum 100 characters</li>
                    </ul>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Update Password</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Password confirmation validation
    document.addEventListener('DOMContentLoaded', function() {
        const passwordForm = document.querySelector('form[action="/api/v1/admin/settings/update-password"]');
        
        if (passwordForm) {
            passwordForm.addEventListener('submit', function(e) {
                const newPassword = document.getElementById('new_password').value;
                const confirmPassword = document.getElementById('confirm_password').value;
                
                if (newPassword !== confirmPassword) {
                    e.preventDefault();
                    showToast('Passwords do not match', 'error');
                    return false;
                }
            });
        }

        // Username validation
        const usernameForm = document.querySelector('form[action="/api/v1/admin/settings/update-username"]');
        
        if (usernameForm) {
            usernameForm.addEventListener('submit', function(e) {
                const newUsername = document.getElementById('new_username').value;
                const currentUsername = document.getElementById('current_username').value;
                
                if (newUsername === currentUsername) {
                    e.preventDefault();
                    showToast('New username must be different from current username', 'error');
                    return false;
                }
            });
        }
    });
</script>
{% endblock %}
